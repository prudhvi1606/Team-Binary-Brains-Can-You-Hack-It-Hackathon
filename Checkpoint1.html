<!DOCTYPE html>
<html lang="en">
<head>
<title>Space Miner Game</title>
<style>
  canvas {
    background: #000;
    display: block;
    margin: 0 auto;
  }
</style>
</head> 
<body>
<canvas id="gameCanvas" width="600" height="400"></canvas>
<script>
class Player {
  constructor(game) {
    this.game = game;
    this.x = 50;
    this.y = game.height / 2;
    this.width = 40;
    this.height = 40;
    this.speedY = 0;
    this.maxSpeed = 4;
    this.health = 5;
    this.ammo = 20;
    this.maxAmmo = 20;
    this.ammoTimer = 0;
    this.ammoRechargeInterval = 500; // milliseconds
    this.projectiles = [];
  }
  
  update(deltaTime) {
    this.y += this.speedY;
    this.y = Math.max(0, Math.min(this.y, this.game.height - this.height));

    // Ammo recharge timer
    if (this.ammo < this.maxAmmo) {
      this.ammoTimer += deltaTime;
      if (this.ammoTimer > this.ammoRechargeInterval) {
        this.ammo++;
        this.ammoTimer = 0;
      }
    }
    
    // Update projectiles
    this.projectiles.forEach(projectile => projectile.update());
    // Remove projectiles marked for deletion
    this.projectiles = this.projectiles.filter(p => !p.markedForDeletion);
  }
  
  draw(ctx) {
    // Draw the ship (simple rectangle)
    ctx.fillStyle = 'cyan';
    ctx.fillRect(this.x, this.y, this.width, this.height);

    // Draw projectiles
    this.projectiles.forEach(projectile => projectile.draw(ctx));
  }
  
  shoot() {
    if (this.ammo > 0) {
      this.projectiles.push(new Projectile(this.game, this.x + this.width, this.y + this.height / 2));
      this.ammo--;
    }
  }
}

class Projectile {
  constructor(game, x, y) {
    this.game = game;
    this.x = x;
    this.y = y;
    this.width = 10;
    this.height = 3;
    this.speed = 6;
    this.markedForDeletion = false;
  }
  
  update() {
    this.x += this.speed;
    if (this.x > this.game.width) this.markedForDeletion = true;
  }
  
  draw(ctx) {
    ctx.fillStyle = 'yellow';
    ctx.fillRect(this.x, this.y, this.width, this.height);
  }
}

class Asteroid {
  constructor(game) {
    this.game = game;
    this.size = Math.random() * 30 + 20;
    this.x = this.game.width;
    this.y = Math.random() * (this.game.height - this.size);
    this.speed = Math.random() * 2 + 2;
    this.health = Math.ceil(this.size / 10);
    this.markedForDeletion = false;
  }
  
  update() {
    this.x -= this.speed;
    if (this.x + this.size < 0) this.markedForDeletion = true;
  }
  
  draw(ctx) {
    ctx.fillStyle = 'gray';
    ctx.beginPath();
    ctx.arc(this.x + this.size/2, this.y + this.size/2, this.size/2, 0, Math.PI * 2);
    ctx.fill();
  }
}

class PowerUp {
  constructor(game) {
    this.game = game;
    this.x = this.game.width;
    this.y = Math.random() * (this.game.height - 20);
    this.width = 20;
    this.height = 20;
    this.speed = 3;
    this.type = Math.random() < 0.5 ? 'shield' : 'ammo';
    this.markedForDeletion = false;
  }
  
  update() {
    this.x -= this.speed;
    if (this.x + this.width < 0) this.markedForDeletion = true;
  }
  
  draw(ctx) {
    ctx.fillStyle = this.type === 'shield' ? 'blue' : 'orange';
    ctx.fillRect(this.x, this.y, this.width, this.height);
  }
}

class Game {
  constructor(width, height) {
    this.width = width;
    this.height = height;
    this.player = new Player(this);
    this.asteroids = [];
    this.powerUps = [];
    this.asteroidTimer = 0;
    this.asteroidInterval = 1500;
    this.powerUpTimer = 0;
    this.powerUpInterval = 8000;
    this.score = 0;
    this.gameOver = false; 
    this.keys = [];
    this.time = 0;
    this.maxTime = 60000; // 1 minute
  }
  
  update(deltaTime) {
    if (this.gameOver) return;
    
    this.time += deltaTime;
    if (this.time > this.maxTime) this.gameOver = true;

    // Update player
    this.player.update(deltaTime);
    
    // Spawn asteroids
    this.asteroidTimer += deltaTime;
    if (this.asteroidTimer > this.asteroidInterval) {
      this.asteroids.push(new Asteroid(this));
      this.asteroidTimer = 0;
      // increase difficulty over time
      if (this.asteroidInterval > 500) this.asteroidInterval -= 10;
    }
    
    // Update asteroids
    this.asteroids.forEach(asteroid => asteroid.update());
    this.asteroids = this.asteroids.filter(a => !a.markedForDeletion);
    
    // Spawn power-ups
    this.powerUpTimer += deltaTime;
    if (this.powerUpTimer > this.powerUpInterval) {
      this.powerUps.push(new PowerUp(this));
      this.powerUpTimer = 0;
    }
    
    // Update power-ups
    this.powerUps.forEach(powerUp => powerUp.update());
    this.powerUps = this.powerUps.filter(p => !p.markedForDeletion);
    
    // Check collisions
    this.checkCollisions();
  }
  
  draw(ctx) {
    this.player.draw(ctx);
    this.asteroids.forEach(asteroid => asteroid.draw(ctx));
    this.powerUps.forEach(powerUp => powerUp.draw(ctx));
    this.drawUI(ctx);
    
    if (this.gameOver) {
      ctx.fillStyle = 'white';
      ctx.font = '40px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('Game Over', this.width / 2, this.height / 2 - 20);
      ctx.fillText(`Score: ${this.score}`, this.width / 2, this.height / 2 + 30);
    }
  }
  
  drawUI(ctx) {
    ctx.fillStyle = 'white';
    ctx.font = '18px Arial';
    ctx.fillText(`Health: ${this.player.health}`, 20, 30);
    ctx.fillText(`Ammo: ${this.player.ammo}`, 20, 60);
    ctx.fillText(`Score: ${this.score}`, 20, 90);
    ctx.fillText(`Time: ${Math.floor((this.maxTime - this.time) / 1000)}`, 20, 120);
  }
  
  checkCollisions() {
    // Projectiles and asteroids
    this.player.projectiles.forEach(projectile => {
      this.asteroids.forEach(asteroid => {
        if (
          projectile.x < asteroid.x + asteroid.size &&
          projectile.x + projectile.width > asteroid.x &&
          projectile.y < asteroid.y + asteroid.size &&
          projectile.y + projectile.height > asteroid.y
        ) {
          asteroid.health--;
          projectile.markedForDeletion = true;
          if (asteroid.health <= 0) {
            asteroid.markedForDeletion = true;
            this.score += 10;
          }
        }
      });
    });
    
    // Player and asteroids
    this.asteroids.forEach(asteroid => {
      if (
        this.player.x < asteroid.x + asteroid.size &&
        this.player.x + this.player.width > asteroid.x &&
        this.player.y < asteroid.y + asteroid.size &&
        this.player.y + this.player.height > asteroid.y
      ) {
        asteroid.markedForDeletion = true;
        this.player.health--;
        if (this.player.health <= 0) this.gameOver = true;
      }
    });
    
    // Player and power-ups
    this.powerUps.forEach(powerUp => {
      if (
        this.player.x < powerUp.x + powerUp.width &&
        this.player.x + this.player.width > powerUp.x &&
        this.player.y < powerUp.y + powerUp.height &&
        this.player.y + this.player.height > powerUp.y
      ) {
        powerUp.markedForDeletion = true;
        if (powerUp.type === 'ammo') this.player.ammo = this.player.maxAmmo;
        else if (powerUp.type === 'shield') this.player.health = Math.min(this.player.health + 1, 5);
      }
    });
  }
}

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const game = new Game(canvas.width, canvas.height);

let lastTime = 0;
function animate(timeStamp = 0) {
  const deltaTime = timeStamp - lastTime;
  lastTime = timeStamp;
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  game.update(deltaTime);
  game.draw(ctx);
  if (!game.gameOver) requestAnimationFrame(animate);
}
animate();

// Keyboard input handling
window.addEventListener('keydown', function(e) {
  if (e.key === 'ArrowUp') game.player.speedY = -game.player.maxSpeed;
  else if (e.key === 'ArrowDown') game.player.speedY = game.player.maxSpeed;
  else if (e.key === ' ') game.player.shoot();
});
window.addEventListener('keyup', function(e) {
  if (e.key === 'ArrowUp' || e.key === 'ArrowDown') game.player.speedY = 0;
});
</script>
</body>
</html>
